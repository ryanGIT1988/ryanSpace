var clientId = "341726685895718";
var clientSecret = "62d55f6f76433f42c644ef2e9caf91bf";
var callbackUrl = "https://www.scriptr.io/";
var scope = "read_stream,user_photos,user_videos,user_status,manage_pages,read_insights";
var code = request.parameters['code'];
var result;
 
 
if(code == null){
     result = apsdb.social.facebook.getRequestToken(clientId, clientSecret, callbackUrl, scope,"state");
     return result;
}else{
    //this code will run when google does the callback with the code parameter
 
     result = apsdb.social.facebook.getAccessToken(clientId, clientSecret,callbackUrl, code);
    //save the access token of the currently logged in user
     apsdb.callApi("SaveUser",
    { 
     "login" : "asd",
     "apsdb.update" : "true",
     "accessToken" :  result.result.accessToken
     }, null);
    return result;
 
}
 
return {"status" : "success"};